name: Deploy to Firebase Hosting
# ワークフローが実行されるタイミングを定義
on:
  push:
    branches:
      - main  # mainブランチにプッシュされた時に実行

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest  # ワークフローを実行する仮想環境
    steps:
      # 1. リポジトリのソースコードをチェックアウト
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Node.jsの環境をセットアップ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' # プロジェクトで使用しているNode.jsのバージョンを指定

      # 3. Reactアプリの依存関係をインストールし、ビルド
      - name: Install and Build
        run: |
          cd frontend
          npm ci
          npm run build

      # 4. Firebase Hostingへデプロイ
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseToken: '${{ secrets.FIREBASE_TOKEN }}' # ステップ3で設定したSecretを読み込む
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_MY_KAKEIBO_APP_12337 }}'
          projectId: 'my-kakeibo-app-12337'
          # projectId: 'your-firebase-project-id' # .firebasercがあれば不要な場合が多いですが、指定するとより確実です
